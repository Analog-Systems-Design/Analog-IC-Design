<!DOCTYPE HTML>
<html>
<head>
    <title>AnalogDesign</title>
    <link href="https://fonts.googleapis.com/css?family=Voces" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="css/common.css"/>
    <link rel="stylesheet" href="css/style.css"/>
    <script src="js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <SCRIPT SRC='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></SCRIPT>
    <SCRIPT>MathJax.Hub.Config({ tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}})</SCRIPT>
</head>
<body>
    <div class="wrapper">
        <div id="toc"></div>    
    <header id="headtoc">
        <h1 class="header">AnalogDesign</h1>
        <p class="header">Experimenting and Explaining Analog_IC_Design</p>
        <ul>
            <li class="download"><a class="buttons" href="https://github.com/hishamelreedy/analogicdesign">SimulationFiles</a></li>
            <li><a class="buttons github" href="https://github.com/hishamelreedy/analogicdesign">View On GitHub</a></li>
        </ul>
            <p class="header">Feel free to contact me if you don't understand anything</p>
          <p class="header">This project is maintained by <a class="header name" href="https://github.com/hishamelreedy/">HishamElreedy</a></p>
          <p class="header"><blockquote>اللهم لا علم لنا الأ ما علمتنا به انك انت علام الغيوب</blockquote></p>

        </header>
    <section>
    <h1>Analog IC Design</h1>
    <h2>1. Mosfet Large & Small Signal Model</h1>
    We neglected short channel effect  & large VDS effect by using large L=1um and small vds=250mV and we also neglected bodyeffect by grounding the source
    <h3>1.1.Schematic</h3>
    <figure>
        <center><img src="images/Mosfet_Tsmc_130nm.png"/></center>
        <figcaption>Tsmc_130nm_Schematic</figcaption>
    </figure>
    <h3>1.2. ID-Vs-VDS</h3>
    <figure>
        <center><img src="images/IdVsVDS.png" width="100%" height="100%"/></center>
        <caption>Id Vs Vds for Vgs=800mV</caption>
    </figure>
    <h3>1.3. TransConductance</h3>
    <figure>
        <center><img src="images/transconductance1.png"/></center>
        <caption>Credits: Dr. Hesham Omran</caption>
    </figure>
    <figure>
    <center><img src="images/IdVsVGS.png"/></center>
    <caption>ID Vs VGS</caption>
    </figure>
    <figure>
        <center><img src="images/gmcalculation.png"/></center>
        <caption>ID vs VGS and marking our operating point VGS=800mV</caption>
    </figure>
    <p>
    to calculate gm as our small signal was of 1mV amplitude 
    so X2=VGS+1mV, Y2=I(X2) and X1=VGS-1mV, Y1=I(X1) 
    and then gm=dI/dVGS = dY/dx = 5.1e-5 mhos
    </p>
    <figure>
        <center><img src="images/transconductance2.png"/></center>
        <caption>Credits: prof. Hesham Omran</caption>
    </figure>
    <p>
        Our output resistance upper bound is controlled by the value of ro so we can't increase rout than ro where we can find value of ro from simulation with name of gds where gds=1/ro like in figure below
    </p>
    <figure>
        <center><img src="images/gainupperbound.png"/></center>
        <caption>gds=2.433e-S==>ro=23.523Kohms</caption>
    </figure>
    <figure>
        <center><img src="images/increasingro.png"/></center>
        <caption>effect of increasing ro</caption>
        <caption><em>Credits: Prof. Hesham Omran</em></caption>
    </figure>
    <p>
    so we cannot increase our Rout more than 23.523Kohms and also we cannot increase Vds very much to increase ro because this will lead to gate loses its control over the drain current
    </p>
    <p>
    We can model our work above by this model in figure below
    </p>
    <figure>
    <center><img src="images/lowfreqsmallsignalmodel.png"/></center>
    <caption><em>Credits: Prof. Hesham Omran</em></caption>
    </figure>
    <h3>1.4. Short Channel Effects</h3>
    <figure>
    <center><img src="images/shortchanneleffects.png"/></center>
    <caption><em>Credits: Prof. Hesham Omran</em></caption>
    </figure>
    <p>
    Short Channel effects changes the relation between Mosfet drain current and VGS as in case of long channel we use the famous quadratic equation where if we derive transconductance from this equation we find that it is linear which means that it increases with VGS.<br/>
    While in case of short channel the relation between mosfet drain current and VGS becomes linear which means that if we drive transconductance we will find that it is of constant value.
    </p>
    <figure>
        <center><img src="images/shortchanneleffectsro.png"/></center>
        <caption><em>credits:Prof. Hesham Omran</em></caption>
    </figure>
    <p>
    short channel effect affects the value of ro where it increases very much in this case which leads to high gain but Vgs loses control
    </p>
    <h2>2. Basic Amplifier Stages</h2>
    <p>
    we have three basic amplifier toplogies which are:
    <ul>
    <li>Common Source(CS): which acts as Voltage and current amplifier if we inject the signal from the gate and probing on Drain. where source is <mark>common</mark> between Drain and Gate</li>
    <li>Common Gate(CG): which acts as Voltage amplifier and Current Buffer, Buffer means amplifier of gain=1</li>
    <li>Common Drain(CD) or Source Follower(SF)</li>
    </ul>
    </p>
    <figure>
        <center><img src="images/basicamplifierstages/basicmosfetamplifiertopologies.png"/></center>
        <caption><em>credits:Prof. Hesham Omran</em></caption>
    </figure>
    <h3>2.1. Amplifier Analysis Steps</h3>
    <figure>
        <center><img src="images/basicamplifierstages/amplifieranalysissteps.png"/></center>
        <caption><em>credits:Prof. Hesham Omran</em></caption>
    </figure>
    <p>
    <ol>
    <li>DC analysis: to calculate DC operating point to check operation of mosfet in saturation (VDS>Vov)</li>
    <li>Calculate small signal parameters(gm,ro)</li>
    <li>Determine Amplifier Parameters(Rin, Rout, Av, Ai)</li>
    </ol>
    </p>
    <figure>
        <center><img src="images/basicamplifierstages/largeandsmallsignalanalysis.png"/></center>
        <caption>analysis types</caption>
        <caption><em>credits:Prof. Hesham Omran</em></caption>
    </figure>
    <p>
        Let's summarize all types of analysis to study amplifier parameters,
        we have two types of analysis whether you are doing it by hand or on
        simulator like cadence spectre simulator.
    </p>
        <h4>2.1.1. Large Signal Analysis</h4>
        <ol>
            <li>Voltage Gain</li>
            <li>Current Gain</li>
            <li>Input Resistance</li>
            <li>Output Resistance</li>
            <li>Bandwidth</li>
        </ol>
        <h4>2.1.2 Small Signal Analysis</h4>
        <ol>
            <li>Bias Point</li>
            <li>Signal Swing</li>
            <li>Distortion</li>
        </ol>
    <h4>2.1.3. Direct Analysis on Schematic</h4>
    <figure>
        <center><img src="images/basicamplifierstages/directanalysisonschematic.png"/></center>
        <caption><em>Credits: Prof. Hisham Omran</em></caption>
    </figure>
     <p>
       We can simplify our solution instead of every time removing every transistor and
       draw its small signal model in order to deal with very large circuits that contains
       alot of mos transistors. so first we can remove the vccs gmVgs & gmVbs and add them
       and put them of mosfet drain branch.<br/>
       to simplify more, we found that in most cases gate node is grounded when we are calculating
       small signal model and also we always make the bulk grounded to neglect body effect so that means
       that Vgs=Vbs so we can gm & gmb together in a single gm so delta_Id=(gm+gmb)delta_Vgs
     </p>
     <figure>
        <center><img src="images/basicamplifierstages/directanalysisonschematic2.png"/></center>
        <caption><em>Credits: Prof. Hisham Omran</em></caption>
    </figure> 
    <h4>2.1.4. Common Approximations we usually use:</h4>
    <p>
        intrinsic gain >>>1 because it is the max gain we can reach and these 
        approximations are relative for example you can find (1/gm)~=100Kohms
        which is very large but you will find also that ro=10Mohms thats why I said
        that approximations are relative 
    </p>
    <figure>
        <center><img src="images/basicamplifierstages/commonapproximations.png"/></center>
        <caption><em>Credits: Prof. Hisham Omran</em></caption>
    </figure>
    <h4>2.1.5. Rin/Rout Shortcuts</h4>
    <p>
        We can simplify the way we use when when we try to find input resistance and output resistance
        of the amplifier, like as follow in figure below we can focus on three parts: 
    </p>
    <ul>
        <li>R_LFS: Resistance when looking from source</li>
        <li>R_LFD: Resistance when looking from drain</li>
        <li>Gate_resistance: is always very large so we doesn't care about calculating it</li>
    </ul>
    <p>
        as in figure below: 
    </p>
    <figure>
        <center><img src="images/basicamplifierstages/equivalentresistance.png"/></center>
        <caption><em>Credits: Prof. Hisham Omran</em></caption>
    </figure>
    <h5>2.1.5.1. Resistance Looking From Drain</h5>
    <p>
       The eye determines the that I want to see output resistance infront of the red vertical line opposite
       to it, we will find in this case the gate is grounded which means that vgs is only controlled by 
       the voltage drop resistance Rs==>Vgs=-Ix*Rs and we can also neglect body effect as Vgs=Vbs because gate is grounded
       so we can add gm & gmb to each other while calculating but keep in mind that they are of different 
       values. always try to solve as much as possible on the drawing instead of writting many equations,<br/>
       after all these simplifications we have now only one equation left which is KCL @ node D<br/>
       which is:$$i_x ={ (g_m+g_{mb})*(-i_xR_s)+{v_x-i_xR_S \over r_o}}$$
       $$R_{LFD}={v_x \over i_x}={r_o+[(gm+gm_b)*r_o+1]R_S}=r_o[1+(gm+gm_b)R_s]$$
       which can get from it easily Vx/Ix which corresponds to 
       the value of resistance looking from drain we can neglect Rs comparing to gm*ro<br/>
       we can only put gmb=0 when Rs=0 where we will not have body effect
    </p>
    <figure>
        <center><img src="images/basicamplifierstages/resistancelookingfromdrain.png"/></center>
        <caption><em>Credits: Prof. Hisham Omran</em></caption>
    </figure>
    <p>
       We can say by this derivation that drain is acting like a high impedance node and to summarize we get
       the following equation in figure and its special Case 
    </p>
    <figure>
        <center><img src="images/basicamplifierstages/resistancelookingfromdrain2.png"/></center>
        <caption><em>Credits: Prof. Hisham Omran</em></caption>
    </figure>
    <h5>2.1.5.2. Resistance Looking From Source</h5>
    <p>
        when looking from source we have same condition on gate where Vbs=Vgs & delta_Id=gm*delta_Vgs
         but the voltage on source node will differ because we replaced rs with a voltage source of value Vx 
         and of current Ix which is injected to mosfet so Vgs=Vg-Vs=0-Vx=-Vx and to explain how idrain=isource
         we can say that mosfet acts like a supernode where by conservation law of charge we can tell that the current
         that entered this node from the source, it will exit also from drain  after all these simplifications what
         remains now is performing a kcl at source of mosfet.<br/>
         KCl @ node S: $$i_x={(g_m+g_{mb})*v_x}+{ v_x-i_x*R_D \over r_o}$$
         $$ R_{LFS}={v_x \over i_x}={1 \over {gm+gmb+{1 \over r_o}}}*{(1+{R_D \over r_o})}= {1 \over {g_m+g_{mb}}}*{(1+ {R_D \over r_o})}$$
         $$R_{LFS}={1 \over {g_m+g_{mb}}}*{(1+{R_D \over r_o})}$$
         $$ (@RD=0)$$ $$R_{LFS}={1 \over {g_m+g_{mb}}}$$
         which means that source acts like low impedance node and this connection @Rd=0 we call it diode connected(gate and drain connected)
        because @ this case vds=vgs which means that it is now not a voltage controlled current source and changed to a resistor of 1/gm
        because id=gmvgs=gmvds====>R(diode connected)=Vds/Ids = 1/gm we call it also source absorbtion<br/>
        in terms of large signal analysis the diode connected mosfet is always at saturation because vds=vgs and the condition
        for saturation is Vds>Vgs-Vth which will always be satisfied
         <!--  $$ x = {-b \pm \sqrt{b^2-4ac} \over 2a}.$$ -->
    </p>
    <figure>
        <center><img src="images/basicamplifierstages/resistancelookingfromsource.png"/></center>
        <caption><em>Credits: Prof. Hisham Omran</em></caption>
    </figure>
    <p>
        for below quiz we are trying to calculate Resistance when looking from source for a three cascoded mosfets in order
        to calculate it we will first start with mosfet that is connected to ground in small signal analysis which is Vdd node in
        case of Pmos as in figure below after calculating rseen from each mosfet we substitute the mosfet in the drawing with
        derived R_LFS and then continue on the preceding mosfet and so on, you will find the answer in below quiz is very strange as 
        R_LFS=ro while we said before that resistancelookingfromsource is a low impedance node but ro is of very high impedance
        and this occured due to cascoding transistors which raises our attention to the effect of cascode stages in the future when
        we are talking about amplifiers
    </p>
    <figure>
        <center><img src="images/basicamplifierstages/resistancelookingfromsourcequiz.png"/></center>
        <caption><em>Credits: Prof. Hisham Omran</em></caption>
    </figure>
    <h5>2.1.5.3. summary</h5>
    <figure>
        <center><img src="images/basicamplifierstages/rinroutsummary.png"/></center>
        <caption><em>Credits: Prof. Hisham Omran</em></caption>
    </figure>
    <h3>2.2. Voltage Amplifier Model</h3>
    <p>
        $$R_{in}={v_{in} \over {i_{in}}}$$
        $$R_{out}=R_{thevenin}={v_x \over i_x} @vin=0$$
        $$v_{out,oc}=v_{thevenin}=A_v*v_{in}$$
        $$A_v={v_{out,oc} \over v_{in}}$$
    </p>
    <figure>
        <center><img src="images/basicamplifierstages/voltageamplifiermodel.png"/></center>
        <caption><em>Credits: Prof. Hisham Omran</em></caption>
    </figure>
    <h3>2.3. Common Source Amplifier</h3>
    <p>
        Common Source Amplifier Parameters:
        </p>
        <figure>
            <center><img src="images/basicamplifierstages/commonsourceamplifier.png"/></center>
            <caption>Common Source Amplifier Parameters</caption>
            <caption><em>credits:Prof. Hesham Omran</em></caption>
        </figure>
         <p>
            Remember that we are using the amplifier to amplify Vsig not Vin.<br/>
            which corresponds to Vsignal.
         </p>
         <h4>2.3.1 Case 1. Rout=Inf. using Ideal Current Source </h4> 
         <h5>2.3.1.1 Theory</h5>
         <figure>
            <center><img src="images/basicamplifierstages/maximumgain.png"/></center>
            <caption>Common Source Amplifier Parameters</caption>
            <caption><em>credits:Prof. Hesham Omran</em></caption>
        </figure>
         <p>
            Intrinsic gain means maximum gain which I can obtain from a 
            single transistor
         </p>
         <figure>
            <center><img src="images/basicamplifierstages/smallsignalanalysiscommonsourcenorout.png"/></center>
            <caption><em>credits:Prof. Hesham Omran</em></caption>
        </figure>
         <p>
            small signal analysis with rout=inf. by using ideal current source, first item you start 
            to debug in simulation is the bias point because all preceding parameters depend on it
         </p>
         <h5>2.3.1.2 simulation</h5>
         <figure>
            <center><img src="images/basicamplifierstages/smallsignalanalysiscommonsourcenoroutsim.png"/></center>
            <caption><em>Credits: Eng. Hisham Elreedy</em></caption>
        </figure>
         <p>
            you wil find vout(red curve) is larger than vin and also of phase difference of pi
            when I bias with current source I no longer need to adjust Vds and worry about its effect on
            gate voltage for losing control over the electron channel
         </p>
         <h5>2.3.1.3 Hand Analysis</h5>
         <p>
            First draw current branch on mosfet drain branch and draw ro in parallel with Vds
            and vbs connect it to ground away from the circuit as in figure below
        </p>
         <figure>
            <center><img src="images/basicamplifierstages/commonsourceanalysis.png"/></center>
            <caption><em>Credits: prof. Hesham Omran</em></caption>
        </figure>
        <p>
            Second combine gm*vgs and gmb*vbs because gate is grounded and then combine them
            in a single gm*vgs and calculate vout by applying kvl on the loop between vout and gnd
            to obtain vout like in figure below which is equal to Vout=-(gm*Vgs)*ro and vin = Vgs
            then we can obtain voltage gain(Av)=Vout/Vin=-gm*ro which demonstrates the results
            that we obtained in the simulation 
        </p>
         <figure>
            <center><img src="images/basicamplifierstages/commonsourceanalysis2.png"/></center>
            <caption><em>Credits: prof. Hesham Omran</em></caption>
        </figure>
        <figure>
            <center><img src="images/basicamplifierstages/commonsourceanalysis3.png"/></center>
            <caption><em>Credits: prof. Hesham Omran</em></caption>
        </figure>
    
<h4>2.3.2 Case 2: using finite drain resistance </h4>
    <figure>
        <center><img src="images/basicamplifierstages/currentsourcegainth.png"/></center>
        <caption><em>credits:Prof. Hesham Omran</em></caption>
    </figure>
    <figure>
        <center><img src="images/basicamplifierstages/currentsourcegainth2.png"/></center>
        <caption><em>credits:Prof. Hesham Omran</em></caption>
    </figure>
    <figure>
        <center><img src="images/basicamplifierstages/currentsourcegain.png"/></center>
        <caption>Common source Gain</caption>
    </figure>
    <p>
    I removed dc value when plotting output by subtracting the output voltage from the average of the total signal using cadence calculator, you will find that they change in phase to explain this:<br />
    when <mark>vgs increases drain</mark> current increases which affect vout precedingly as voltage drop on resistance increases which makes <mark>Vout decreases</marK> thats why they have phase difference of pi==(180 degrees)
    </p>
    <figure>
        <center><img src="images/basicamplifierstages/smallsignalanalysiscommonsourceroutsim.png"/></center>
        <caption><em>Credits: Eng. Hisham Elreedy</em></caption>
    </figure>
     <p>
        vds problem starts to rise here when we put finite resistance on the drain where it made
        the amplifier with very low gain and when we increase Rout we can't increase it than ro=23.523Kohms
     </p>
     <h2>3. Cascode Amplifier</h2>
     <p>

     </p>
</section>
<footer>
    <p><small>Hosted on <a href="https://www.github.com/hishamelreedy/">GitHub Pages</a> by HishamElreedy</small></p>
</footer>
</div>
    <script src="js/common.js"></script>
    <script>$('#toc').toc();</script>
</body>
</html>